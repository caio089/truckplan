{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruckPlan - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- JavaScript Simplificado -->
    <script src="{% static 'login/js/dashboard-simple.js' %}"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a'
                        },
                        secondary: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'bounce-gentle': 'bounceGentle 2s infinite',
                        'pulse-slow': 'pulse 3s infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        bounceGentle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #4b5563 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .text-gradient {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Background Animation -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-white/5 rounded-full animate-pulse-slow"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-gray-400/10 rounded-full animate-bounce-gentle"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-gray-300/5 rounded-full animate-pulse-slow"></div>
    </div>

    <!-- Navigation -->
    <nav class="relative z-10 p-6">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <span class="text-3xl">üöõ</span>
                <h1 class="text-2xl font-bold text-white">TruckPlan</h1>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-gray-300">Bem-vindo, {{ user.username }}!</span>
                <a href="{% url 'logout' %}" class="bg-gray-800/50 hover:bg-gray-700/50 text-white px-4 py-2 rounded-lg transition-all duration-300 backdrop-blur-sm border border-gray-600">
                    Sair
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="relative z-10 max-w-7xl mx-auto px-6 pb-12">
        <!-- Welcome Section -->
        <div class="text-center mb-12 animate-slide-up">
            <h2 class="text-4xl font-bold text-white mb-4">Dashboard</h2>
            <p class="text-gray-300 text-lg">Sistema de Controle de Despesas de Caminh√£o</p>
        </div>

        <!-- Resumo Financeiro -->
        <div class="glass-effect rounded-2xl p-8 animate-slide-up border border-gray-600/30 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Resumo Financeiro</h3>
                <div class="flex space-x-2">
                    <button id="btnSemanal" onclick="alternarResumo('semanal')" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold transition-all duration-300">
                        Semanal
                    </button>
                    <button id="btnMensal" onclick="alternarResumo('mensal')" class="px-4 py-2 bg-gray-600 text-white rounded-lg font-semibold transition-all duration-300">
                        Mensal
                    </button>
                </div>
            </div>
            
            <div id="resumoSemanal" class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-gradient-to-r from-red-600 to-red-700 rounded-2xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100 text-sm font-medium">Total de Gastos</p>
                            <p class="text-3xl font-bold" id="totalGastosSemanal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Esta semana</p>
                        </div>
                        <div class="text-4xl opacity-80">üí∞</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-green-600 to-green-700 rounded-2xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm font-medium">Total de Receitas</p>
                            <p class="text-3xl font-bold" id="totalReceitasSemanal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Esta semana</p>
                        </div>
                        <div class="text-4xl opacity-80">üìà</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-purple-600 to-purple-700 rounded-2xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm font-medium">Lucro L√≠quido</p>
                            <p class="text-3xl font-bold" id="lucroLiquidoSemanal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Esta semana</p>
                        </div>
                        <div class="text-4xl opacity-80">üíé</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-2xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-100 text-sm font-medium">M√©dia Di√°ria</p>
                            <p class="text-3xl font-bold" id="mediaDiariaSemanal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Por dia</p>
                        </div>
                        <div class="text-4xl opacity-80">üìä</div>
                    </div>
                </div>
            </div>

            <div id="resumoMensal" class="grid grid-cols-1 md:grid-cols-4 gap-6 hidden">
                <div class="bg-gradient-to-r from-red-600 to-red-700 rounded-2xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100 text-sm font-medium">Total de Gastos</p>
                            <p class="text-3xl font-bold" id="totalGastosMensal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Este m√™s</p>
                        </div>
                        <div class="text-4xl opacity-80">üí∞</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-green-600 to-green-700 rounded-2xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm font-medium">Total de Receitas</p>
                            <p class="text-3xl font-bold" id="totalReceitasMensal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Este m√™s</p>
                        </div>
                        <div class="text-4xl opacity-80">üìà</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-purple-600 to-purple-700 rounded-2xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm font-medium">Lucro L√≠quido</p>
                            <p class="text-3xl font-bold" id="lucroLiquidoMensal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Este m√™s</p>
                        </div>
                        <div class="text-4xl opacity-80">üíé</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-2xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-100 text-sm font-medium">M√©dia Di√°ria</p>
                            <p class="text-3xl font-bold" id="mediaDiariaMensal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Por dia</p>
                        </div>
                        <div class="text-4xl opacity-80">üìä</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Busca por Data -->
        <div class="glass-effect rounded-2xl p-8 animate-slide-up border border-gray-600/30 mb-8">
            <h3 class="text-2xl font-bold text-white mb-6">üîç Buscar Relat√≥rios por Data</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-gray-200 text-sm font-semibold mb-2">Data Inicial</label>
                    <input type="date" id="dataInicial" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20">
                </div>
                <div>
                    <label class="block text-gray-200 text-sm font-semibold mb-2">Data Final</label>
                    <input type="date" id="dataFinal" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20">
                </div>
                <div class="flex items-end">
                    <button onclick="buscarRelatoriosPorData()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300">
                        üîç Buscar
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="glass-effect rounded-2xl p-8 animate-slide-up border border-gray-600/30 mb-8">
            <h3 class="text-2xl font-bold text-white mb-6">A√ß√µes R√°pidas</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <button onclick="openReportModal()" class="bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white p-6 rounded-xl font-semibold text-lg hover:-translate-y-1 hover:shadow-xl transition-all duration-300 border border-gray-600">
                    <div class="flex flex-col items-center justify-center space-y-2">
                        <span class="text-3xl">üìä</span>
                        <span class="text-sm">Novo Relat√≥rio</span>
                    </div>
                </button>

                <button onclick="mostrarRelatoriosHoje()" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white p-6 rounded-xl font-semibold text-lg hover:-translate-y-1 hover:shadow-xl transition-all duration-300 border border-green-500">
                    <div class="flex flex-col items-center justify-center space-y-2">
                        <span class="text-3xl">üìÖ</span>
                        <span class="text-sm">Hoje</span>
                    </div>
                </button>

                <button onclick="mostrarRelatoriosSemana()" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white p-6 rounded-xl font-semibold text-lg hover:-translate-y-1 hover:shadow-xl transition-all duration-300 border border-blue-500">
                    <div class="flex flex-col items-center justify-center space-y-2">
                        <span class="text-3xl">üìà</span>
                        <span class="text-sm">Esta Semana</span>
                    </div>
                </button>

                <button onclick="mostrarRelatoriosMes()" class="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-500 hover:to-purple-600 text-white p-6 rounded-xl font-semibold text-lg hover:-translate-y-1 hover:shadow-xl transition-all duration-300 border border-purple-500">
                    <div class="flex flex-col items-center justify-center space-y-2">
                        <span class="text-3xl">üìä</span>
                        <span class="text-sm">Este M√™s</span>
                    </div>
                </button>
            </div>
            
            <!-- Bot√£o para limpar dados de teste -->
            <div class="mt-6 text-center">
                <button onclick="clearAllTestData()" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300 border border-red-500">
                    <i class="fas fa-trash mr-2"></i>
                    Limpar Dados de Teste
                </button>
            </div>
        </div>

        <!-- Resultados da Busca -->
        <div id="resultadosBusca" class="hidden">
            <div class="glass-effect rounded-2xl p-8 animate-slide-up border border-gray-600/30 mb-8">
                <h3 class="text-2xl font-bold text-white mb-6">üìä Resultados da Busca</h3>
                <div id="resumoResultados" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Resumo ser√° preenchido aqui -->
                </div>
                <div id="tabelaResultados" class="overflow-x-auto">
                    <!-- Tabela ser√° preenchida aqui -->
                </div>
            </div>
        </div>

    </div>

    <!-- Modal para Gerar Novo Relat√≥rio -->
    <div id="reportModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Gerar Novo Relat√≥rio</h3>
                <button onclick="closeReportModal()" class="text-gray-400 hover:text-white text-2xl">√ó</button>
            </div>
            
            <form id="reportForm" class="space-y-6">
                <!-- Cadastro de Viagem (Relat√≥rio Di√°rio) -->
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-white">Cadastro de Viagem (Relat√≥rio Di√°rio)</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Data da Viagem *</label>
                            <input type="date" id="dataViagem" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Local de Partida *</label>
                            <input type="text" id="localPartida" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="Ex: S√£o Paulo - SP" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Local de Chegada *</label>
                            <input type="text" id="localChegada" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="Ex: Rio de Janeiro - RJ" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Quantidade de Di√°rias *</label>
                            <input type="number" id="quantidadeDiarias" min="1" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="1" oninput="calcularDiarias()" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Nome do Motorista *</label>
                            <input type="text" id="nomeMotorista" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="Nome completo do motorista" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Nome do Caminh√£o *</label>
                            <input type="text" id="nomeCaminhao" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="Ex: Volvo FH 540" required>
                        </div>
                    </div>
                </div>

                <!-- Despesas da Viagem -->
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-white">Despesas da Viagem</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Litros de Gasolina Gastos *</label>
                            <input type="number" id="litrosGasolina" step="0.01" min="0" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="0,00" oninput="calcularGastosViagem()" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Valor Gasto com Gasolina (R$) *</label>
                            <input type="number" id="valorGasolina" step="0.01" min="0" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="0,00" oninput="calcularGastosViagem()" required>
                        </div>
                    </div>
                    
                    <!-- C√°lculo Autom√°tico de Di√°rias -->
                    <div class="bg-blue-900/20 p-4 rounded-xl border border-blue-600/30">
                        <h5 class="text-md font-semibold text-blue-300 mb-3">üí∞ C√°lculo Autom√°tico de Di√°rias</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-300">Quantidade de Di√°rias:</span>
                                <span class="text-white font-semibold" id="quantidadeDiariasDisplay">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300">Valor por Di√°ria:</span>
                                <span class="text-white font-semibold">R$ 70,00</span>
                            </div>
                            <div class="flex justify-between col-span-2 border-t border-blue-600/30 pt-2">
                                <span class="text-blue-300 font-semibold">Total de Di√°rias:</span>
                                <span class="text-blue-400 font-bold text-lg" id="totalDiariasDisplay">R$ 0,00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resumo de Gastos da Viagem -->
                    <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-600/30">
                        <h5 class="text-md font-semibold text-white mb-3">üìä Resumo de Gastos da Viagem</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-300">Gasto com Gasolina:</span>
                                <span class="text-white font-semibold" id="gastoGasolinaDisplay">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300">Total de Di√°rias:</span>
                                <span class="text-white font-semibold" id="totalDiariasResumo">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between col-span-2 border-t border-gray-600 pt-2">
                                <span class="text-gray-300 font-semibold">Total de Gastos da Viagem:</span>
                                <span class="text-red-400 font-bold text-lg" id="totalGastosViagemDisplay">R$ 0,00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 1.1 Custos Gerais -->
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-white">1.1 Custos Gerais</h4>
                    
                    <!-- Busca e Filtros -->
                    <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-600/30">
                        <h5 class="text-md font-semibold text-white mb-3">Buscar Custos Existentes</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Buscar por Placa</label>
                                <input type="text" id="buscarPlaca" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="ABC-1234" oninput="buscarCustosPorPlaca()">
                            </div>
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Filtrar por Tipo</label>
                                <select id="filtrarTipo" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" onchange="filtrarCustosPorTipo()">
                                    <option value="">Todos os tipos</option>
                                    <option value="manutencao">Manuten√ß√£o</option>
                                    <option value="ipva">IPVA</option>
                                    <option value="seguro">Seguro</option>
                                    <option value="batida">Batida</option>
                                    <option value="pecas">Pe√ßas</option>
                                    <option value="acessorios">Acess√≥rios</option>
                                    <option value="combustivel">Combust√≠vel</option>
                                    <option value="documentacao">Documenta√ß√£o</option>
                                    <option value="multas">Multas</option>
                                    <option value="estacionamento">Estacionamento</option>
                                    <option value="pedagio">Ped√°gio</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                        </div>
                        <div id="custosEncontrados" class="space-y-2 max-h-40 overflow-y-auto">
                            <!-- Custos encontrados ser√£o exibidos aqui -->
                        </div>
                    </div>
                    
                    <!-- Adicionar Novo Custo -->
                    <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-600/30">
                        <h5 class="text-md font-semibold text-white mb-3">Adicionar Novo Custo</h5>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Tipo de Gasto *</label>
                                <select id="tipoGasto" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                    <option value="">Selecione o tipo</option>
                                    <option value="manutencao">Manuten√ß√£o</option>
                                    <option value="ipva">IPVA</option>
                                    <option value="seguro">Seguro</option>
                                    <option value="batida">Batida</option>
                                    <option value="pecas">Pe√ßas</option>
                                    <option value="acessorios">Acess√≥rios</option>
                                    <option value="combustivel">Combust√≠vel</option>
                                    <option value="documentacao">Documenta√ß√£o</option>
                                    <option value="multas">Multas</option>
                                    <option value="estacionamento">Estacionamento</option>
                                    <option value="pedagio">Ped√°gio</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Data *</label>
                                <input type="date" id="dataCusto" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Ve√≠culo (Placa) *</label>
                                <input type="text" id="placaCusto" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="ABC-1234" maxlength="8" oninput="formatPlaca(this)">
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Oficina/Fornecedor *</label>
                                <input type="text" id="oficinaFornecedor" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="Nome da oficina ou fornecedor">
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Descri√ß√£o do Servi√ßo/Pe√ßa *</label>
                            <textarea id="descricaoCusto" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" rows="2" placeholder="Descreva o servi√ßo realizado ou pe√ßa adquirida"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Valor (R$) *</label>
                                <input type="number" id="valorCusto" step="0.01" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="0,00">
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Forma de Pagamento *</label>
                                <select id="formaPagamento" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                    <option value="">Selecione</option>
                                    <option value="boleto">Boleto</option>
                                    <option value="vista">√Ä Vista</option>
                                    <option value="fiado">Fiado</option>
                                    <option value="aberto">Em Aberto</option>
                                    <option value="credito">Cart√£o de Cr√©dito</option>
                                    <option value="debito">Cart√£o de D√©bito</option>
                                    <option value="pix">PIX</option>
                                    <option value="transferencia">Transfer√™ncia</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="parcelado">Parcelado</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Status de Pagamento *</label>
                                <select id="statusPagamento" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                    <option value="">Selecione</option>
                                    <option value="pago">Pago</option>
                                    <option value="nao_pago">N√£o Pago</option>
                                    <option value="parcial">Parcialmente Pago</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Data de Vencimento</label>
                                <input type="date" id="dataVencimento" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Comprovante/Boleto</label>
                                <input type="file" id="comprovante" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-2">
                            <button type="button" onclick="adicionarCustoGeral()" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white px-6 py-2 rounded-lg font-semibold transition-all duration-300">
                                Adicionar Custo
                            </button>
                        </div>
                    </div>
                    
                    <!-- Lista de Custos Adicionados -->
                    <div id="listaCustosGerais" class="space-y-2">
                        <!-- Custos adicionados ser√£o exibidos aqui -->
                    </div>
                </div>

                <!-- Receita -->
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Receita</h4>
                    <div>
                        <label class="block text-gray-200 text-sm font-semibold mb-2">Receita/Frete (R$)</label>
                        <input type="number" id="receita" step="0.01" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="0,00">
                    </div>
                </div>

                <!-- Resumo Autom√°tico -->
                <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-600/30">
                    <h4 class="text-lg font-semibold text-white mb-3">Resumo Autom√°tico</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-300">Total Despesas:</span>
                            <span class="text-white font-semibold" id="totalDespesasPreview">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-300">Receita:</span>
                            <span class="text-white font-semibold" id="receitaPreview">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between col-span-2 border-t border-gray-600 pt-2">
                            <span class="text-gray-300">Lucro L√≠quido:</span>
                            <span class="text-green-400 font-bold text-lg" id="lucroLiquidoPreview">R$ 0,00</span>
                        </div>
                    </div>
                </div>

                <!-- Bot√µes -->
                <div class="flex space-x-4">
                    <button type="button" onclick="closeReportModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300 border border-gray-600">
                        Salvar Relat√≥rio
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Ver Resumo de Relat√≥rio -->
    <div id="reportSummaryModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Resumo do Relat√≥rio</h3>
                <button onclick="closeReportSummaryModal()" class="text-gray-400 hover:text-white text-2xl">√ó</button>
            </div>
            
            <div id="reportSummaryContent">
                <!-- Conte√∫do ser√° preenchido via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal para Relat√≥rios Anteriores -->
    <div id="previousReportsModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Relat√≥rios Anteriores</h3>
                <button onclick="closePreviousReportsModal()" class="text-gray-400 hover:text-white text-2xl">√ó</button>
            </div>
            
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-gray-200 text-sm font-semibold mb-2">Filtrar por Per√≠odo</label>
                        <select id="periodSelect" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20">
                            <option value="day">Por Dia</option>
                            <option value="week">Por Semana</option>
                            <option value="month">Por M√™s</option>
                            <option value="custom">Data Espec√≠fica</option>
                        </select>
                    </div>
                    
                    <div id="customDateContainer" class="hidden">
                        <label class="block text-gray-200 text-sm font-semibold mb-2">Selecionar Data</label>
                        <input type="date" id="customDate" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20">
                    </div>
                </div>
                
                <div class="flex space-x-4 mb-6">
                    <button onclick="generatePeriodReport()" class="bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300">
                        Gerar Relat√≥rio
                    </button>
                    <button onclick="clearFilters()" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300">
                        Limpar Filtros
                    </button>
                </div>
                
                <div id="periodReportContent" class="space-y-4">
                    <!-- Conte√∫do ser√° preenchido via JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o de Exclus√£o -->
    <div id="confirmDeleteModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-md">
            <div class="text-center">
                <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                <h3 class="text-2xl font-bold text-white mb-4">Confirmar Exclus√£o</h3>
                <p class="text-gray-300 mb-6" id="confirmDeleteMessage">
                    Tem certeza que deseja excluir este relat√≥rio?
                </p>
                <div class="flex space-x-4">
                    <button onclick="closeConfirmDeleteModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                        Cancelar
                    </button>
                    <button onclick="confirmDelete()" class="flex-1 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                        Excluir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Configura√ß√µes -->
    <div id="settingsModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Configura√ß√µes</h3>
                <button onclick="closeSettingsModal()" class="text-gray-400 hover:text-white text-2xl">√ó</button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Alterar Senha/Login</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Nova Senha</label>
                            <input type="password" id="newPassword" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20">
                        </div>
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Confirmar Nova Senha</label>
                            <input type="password" id="confirmPassword" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20">
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Backup e Restaura√ß√£o</h4>
                    <div class="space-y-4">
                        <button onclick="exportData()" class="w-full bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                            Exportar Dados (JSON)
                        </button>
                        <button onclick="importData()" class="w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                            Importar Dados
                        </button>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Prefer√™ncias de Exibi√ß√£o</h4>
                    <div class="space-y-4">
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="darkMode" checked class="w-4 h-4 text-gray-600 bg-gray-800 border-gray-600 rounded focus:ring-gray-500">
                            <span class="text-gray-200">Modo Escuro (Atual)</span>
                        </label>
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="notifications" checked class="w-4 h-4 text-gray-600 bg-gray-800 border-gray-600 rounded focus:ring-gray-500">
                            <span class="text-gray-200">Notifica√ß√µes</span>
                        </label>
                    </div>
                </div>
                
                <div class="flex space-x-4">
                    <button onclick="closeSettingsModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                        Fechar
                    </button>
                    <button onclick="saveSettings()" class="flex-1 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                        Salvar Configura√ß√µes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados armazenados localmente
        // Limpar todos os dados de teste
        localStorage.removeItem('truckReports');
        localStorage.removeItem('truckCosts');
        
        let reports = [];
        let currentWeekData = { gastos: 0, lucros: 0, lucroLiquido: 0 };

        // Fun√ß√£o para limpar todos os dados de teste
        function clearAllTestData() {
            // Limpar localStorage
            localStorage.removeItem('truckReports');
            localStorage.removeItem('truckCosts');
            localStorage.removeItem('truckReportsBackup');
            
            // Limpar arrays
            reports = [];
            custosGerais = [];
            custosGeraisRelatorio = [];
            
            // Limpar interface sem recarregar dados
            limparInterface();
            
            console.log('Todos os dados de teste foram removidos!');
        }
        
        // Fun√ß√£o para limpar interface sem recarregar dados
        function limparInterface() {
            // Limpar resumo semanal
            const totalGastosElement = document.getElementById('totalGastosSemanal');
            const totalReceitasElement = document.getElementById('totalReceitasSemanal');
            const lucroLiquidoElement = document.getElementById('lucroLiquidoSemanal');
            const mediaDiariaElement = document.getElementById('mediaDiariaSemanal');
            
            if (totalGastosElement) totalGastosElement.textContent = 'R$ 0,00';
            if (totalReceitasElement) totalReceitasElement.textContent = 'R$ 0,00';
            if (lucroLiquidoElement) {
                lucroLiquidoElement.textContent = 'R$ 0,00';
                lucroLiquidoElement.className = 'text-3xl font-bold text-gray-300';
            }
            if (mediaDiariaElement) mediaDiariaElement.textContent = 'R$ 0,00';
            
            // Limpar resumo mensal
            const totalGastosMensalElement = document.getElementById('totalGastosMensal');
            const totalReceitasMensalElement = document.getElementById('totalReceitasMensal');
            const lucroLiquidoMensalElement = document.getElementById('lucroLiquidoMensal');
            const mediaDiariaMensalElement = document.getElementById('mediaDiariaMensal');
            
            if (totalGastosMensalElement) totalGastosMensalElement.textContent = 'R$ 0,00';
            if (totalReceitasMensalElement) totalReceitasMensalElement.textContent = 'R$ 0,00';
            if (lucroLiquidoMensalElement) {
                lucroLiquidoMensalElement.textContent = 'R$ 0,00';
                lucroLiquidoMensalElement.className = 'text-3xl font-bold text-gray-300';
            }
            if (mediaDiariaMensalElement) mediaDiariaMensalElement.textContent = 'R$ 0,00';
            
            // Ocultar resultados de busca
            const resultadosDiv = document.getElementById('resultadosBusca');
            if (resultadosDiv) {
                resultadosDiv.classList.add('hidden');
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Limpar todos os dados de teste
            clearAllTestData();
            
            // Definir data atual como padr√£o
            document.getElementById('dataViagem').value = new Date().toISOString().split('T')[0];
            
            // N√ÉO atualizar resumo da semana automaticamente para manter sistema limpo
            // updateWeekSummary(); // Removido para evitar recarregamento
            
            // Adicionar listeners para c√°lculo autom√°tico
            setupReportFormListeners();
            
            // Anima√ß√µes de entrada
            const cards = document.querySelectorAll('.animate-fade-in');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
            });
        });

        // Configurar listeners do formul√°rio de relat√≥rio
        function setupReportFormListeners() {
            const inputs = ['quantidadeDiarias', 'litrosGasolina', 'valorGasolina', 'receita'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateReportPreview);
                }
            });
        }

        // ========== FUN√á√ïES PARA C√ÅLCULO DE VIAGEM ==========
        
        // Calcular di√°rias automaticamente
        function calcularDiarias() {
            const quantidade = parseInt(document.getElementById('quantidadeDiarias').value) || 0;
            const valorPorDiaria = 70.00;
            const totalDiarias = quantidade * valorPorDiaria;
            
            // Atualizar displays
            document.getElementById('quantidadeDiariasDisplay').textContent = quantidade;
            document.getElementById('totalDiariasDisplay').textContent = `R$ ${totalDiarias.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalDiariasResumo').textContent = `R$ ${totalDiarias.toFixed(2).replace('.', ',')}`;
            
            // Atualizar preview geral diretamente (evitar loop)
            updateReportPreview();
        }
        
        // Calcular gastos da viagem
        function calcularGastosViagem() {
            const quantidadeDiarias = parseInt(document.getElementById('quantidadeDiarias').value) || 0;
            const valorGasolina = parseFloat(document.getElementById('valorGasolina').value) || 0;
            const totalDiarias = quantidadeDiarias * 70.00;
            const totalGastosViagem = valorGasolina + totalDiarias;
            
            // Atualizar displays
            document.getElementById('gastoGasolinaDisplay').textContent = `R$ ${valorGasolina.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalGastosViagemDisplay').textContent = `R$ ${totalGastosViagem.toFixed(2).replace('.', ',')}`;
            
            // Atualizar preview geral (sem recurs√£o)
            updateReportPreview();
        }

        // Atualizar preview do relat√≥rio
        function updateReportPreview() {
            // Dados da viagem
            const quantidadeDiarias = parseInt(document.getElementById('quantidadeDiarias').value) || 0;
            const valorGasolina = parseFloat(document.getElementById('valorGasolina').value) || 0;
            const receita = parseFloat(document.getElementById('receita').value) || 0;

            // Calcular totais
            const totalDiarias = quantidadeDiarias * 70.00;
            const totalCustosGerais = custosGeraisRelatorio.reduce((sum, custo) => sum + custo.valor, 0);
            const totalGastosViagem = valorGasolina + totalDiarias;
            const totalDespesas = totalGastosViagem + totalCustosGerais;
            const lucroLiquido = receita - totalDespesas;

            document.getElementById('totalDespesasPreview').textContent = `R$ ${totalDespesas.toFixed(2).replace('.', ',')}`;
            document.getElementById('receitaPreview').textContent = `R$ ${receita.toFixed(2).replace('.', ',')}`;
            document.getElementById('lucroLiquidoPreview').textContent = `R$ ${lucroLiquido.toFixed(2).replace('.', ',')}`;
            
            // Mudar cor do lucro
            const lucroElement = document.getElementById('lucroLiquidoPreview');
            if (lucroLiquido >= 0) {
                lucroElement.className = 'text-green-400 font-bold text-lg';
            } else {
                lucroElement.className = 'text-red-400 font-bold text-lg';
            }
        }

        // Atualizar resumo da semana
        function updateWeekSummary() {
            console.log('Atualizando resumo da semana...');
            console.log('Total de relat√≥rios:', reports.length);
            
            const currentWeek = getCurrentWeek();
            const weekReports = reports.filter(report => {
                const reportDate = new Date(report.date);
                return isSameWeek(reportDate, currentWeek);
            });

            console.log('Relat√≥rios da semana atual:', weekReports.length);

            let totalGastos = 0;
            let totalLucros = 0;

            weekReports.forEach(report => {
                totalGastos += report.totalDespesas || 0;
                totalLucros += report.receita || 0;
                console.log('Relat√≥rio:', report.date, 'Receita:', report.receita, 'Despesas:', report.totalDespesas);
            });

            const lucroLiquido = totalLucros - totalGastos;

            console.log('Totais calculados:', { totalGastos, totalLucros, lucroLiquido });

            // Atualizar elementos do resumo semanal
            const totalGastosElement = document.getElementById('totalGastosSemanal');
            const totalLucrosElement = document.getElementById('totalReceitasSemanal');
            const lucroLiquidoElement = document.getElementById('lucroLiquidoSemanal');

            if (totalGastosElement) {
                totalGastosElement.textContent = `R$ ${totalGastos.toFixed(2).replace('.', ',')}`;
            }
            if (totalLucrosElement) {
                totalLucrosElement.textContent = `R$ ${totalLucros.toFixed(2).replace('.', ',')}`;
            }
            if (lucroLiquidoElement) {
                lucroLiquidoElement.textContent = `R$ ${lucroLiquido.toFixed(2).replace('.', ',')}`;
                
                // Atualizar cor do lucro l√≠quido
                if (lucroLiquido >= 0) {
                    lucroLiquidoElement.className = 'text-3xl font-bold text-green-300';
                } else {
                    lucroLiquidoElement.className = 'text-3xl font-bold text-red-300';
                }
            }
        }

        // Fun√ß√µes de modal
        function openReportModal() {
            // Limpar formul√°rio ao abrir
            limparFormularioViagem();
            
            document.getElementById('reportModal').classList.remove('hidden');
            document.getElementById('dataViagem').value = new Date().toISOString().split('T')[0];
            updateReportPreview();
        }

        function closeReportModal() {
            document.getElementById('reportModal').classList.add('hidden');
            // N√£o limpar o formul√°rio aqui - ser√° feito ap√≥s salvar
        }


        function showPreviousReports() {
            document.getElementById('previousReportsModal').classList.remove('hidden');
            // Configurar listener para mostrar/ocultar campo de data personalizada
            setupPeriodSelectListener();
        }

        function closePreviousReportsModal() {
            document.getElementById('previousReportsModal').classList.add('hidden');
        }

        function showSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        // Salvar relat√≥rio
        document.getElementById('reportForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validar formul√°rio
            if (!validateReportForm()) {
                return;
            }
            
            // Dados da viagem
            const quantidadeDiarias = parseInt(document.getElementById('quantidadeDiarias').value) || 0;
            const valorGasolina = parseFloat(document.getElementById('valorGasolina').value) || 0;
            const totalDiarias = quantidadeDiarias * 70.00;
            const totalCustosGerais = custosGeraisRelatorio.reduce((sum, custo) => sum + custo.valor, 0);
            const totalGastosViagem = valorGasolina + totalDiarias;
            const totalDespesas = totalGastosViagem + totalCustosGerais;
            const receita = parseFloat(document.getElementById('receita').value) || 0;
            const lucroLiquido = receita - totalDespesas;

            // Verificar se √© edi√ß√£o ou cria√ß√£o
            const editId = document.getElementById('reportForm').dataset.editId;
            const isEdit = editId && editId !== '';
            
            const reportData = {
                id: isEdit ? parseInt(editId) : Date.now(),
                date: document.getElementById('dataViagem').value,
                localPartida: document.getElementById('localPartida').value.trim(),
                localChegada: document.getElementById('localChegada').value.trim(),
                quantidadeDiarias: quantidadeDiarias,
                totalDiarias: totalDiarias,
                litrosGasolina: parseFloat(document.getElementById('litrosGasolina').value) || 0,
                valorGasolina: valorGasolina,
                nomeMotorista: document.getElementById('nomeMotorista').value.trim(),
                nomeCaminhao: document.getElementById('nomeCaminhao').value.trim(),
                receita: receita,
                totalGastosViagem: totalGastosViagem,
                totalCustosGerais: totalCustosGerais,
                totalDespesas: totalDespesas,
                lucroLiquido: lucroLiquido,
                custosGerais: [...custosGeraisRelatorio] // Copiar array de custos gerais
            };

            console.log('Salvando relat√≥rio:', reportData);
            console.log('Receita capturada:', receita);
            console.log('Total de despesas:', totalDespesas);
            console.log('Lucro l√≠quido:', lucroLiquido);

            if (isEdit) {
                // Atualizar relat√≥rio existente
                const index = reports.findIndex(r => r.id == editId);
                if (index !== -1) {
                    reports[index] = reportData;
                }
            } else {
                // Adicionar novo relat√≥rio
                reports.unshift(reportData);
            }
            
            localStorage.setItem('truckReports', JSON.stringify(reports));

            console.log('Relat√≥rios salvos no localStorage:', reports.length);

            // Fechar modal primeiro
            closeReportModal();
            
            // Limpar formul√°rio ap√≥s fechar modal
            setTimeout(() => {
                limparFormularioViagem();
                updateWeekSummary();
                const mensagem = isEdit ? 'Relat√≥rio atualizado com sucesso!' : 'Relat√≥rio salvo com sucesso!';
                showNotification(mensagem, 'success');
                
                // Limpar ID de edi√ß√£o
                document.getElementById('reportForm').dataset.editId = '';
            }, 300);
        });

        // Limpar formul√°rio de viagem
        function limparFormularioViagem() {
            document.getElementById('dataViagem').value = new Date().toISOString().split('T')[0];
            document.getElementById('localPartida').value = '';
            document.getElementById('localChegada').value = '';
            document.getElementById('quantidadeDiarias').value = '';
            document.getElementById('litrosGasolina').value = '';
            document.getElementById('valorGasolina').value = '';
            document.getElementById('nomeMotorista').value = '';
            document.getElementById('nomeCaminhao').value = '';
            document.getElementById('receita').value = '';
            
            // Limpar custos gerais
            custosGeraisRelatorio = [];
            atualizarListaCustosGerais();
            
            // Limpar busca de custos
            document.getElementById('buscarPlaca').value = '';
            document.getElementById('filtrarTipo').value = '';
            document.getElementById('custosEncontrados').innerHTML = '';
            
            // Limpar formul√°rio de custo
            limparFormularioCusto();
            
            // Atualizar preview
            updateReportPreview();
        }


        // Ver resumo do relat√≥rio
        function viewReportSummary(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;

            const content = document.getElementById('reportSummaryContent');
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-gray-800/30 p-6 rounded-xl border border-gray-600/30">
                        <h4 class="text-xl font-bold text-white mb-4">Data: ${formatDate(report.date)}</h4>
                        
                        <!-- Informa√ß√µes do Ve√≠culo e Motorista -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-gray-700/30 rounded-lg">
                            <div>
                                <span class="text-gray-300 text-sm">Motorista:</span>
                                <p class="text-white font-semibold">${report.nomeMotorista || 'N√£o informado'}</p>
                            </div>
                            <div>
                                <span class="text-gray-300 text-sm">Caminh√£o:</span>
                                <p class="text-white font-semibold">${report.nomeCaminhao || 'N√£o informado'}</p>
                            </div>
                            <div>
                                <span class="text-gray-300 text-sm">Rota:</span>
                                <p class="text-white font-semibold">${report.localPartida || ''} ‚Üí ${report.localChegada || ''}</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h5 class="text-lg font-semibold text-white mb-3">Despesas Detalhadas</h5>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Gasolina:</span>
                                        <span class="text-white">R$ ${(report.valorGasolina || 0).toFixed(2).replace('.', ',')}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Di√°rias (${report.quantidadeDiarias || 0} x R$ 70,00):</span>
                                        <span class="text-white">R$ ${(report.totalDiarias || 0).toFixed(2).replace('.', ',')}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Custos Gerais:</span>
                                        <span class="text-white">R$ ${(report.totalCustosGerais || 0).toFixed(2).replace('.', ',')}</span>
                                    </div>
                                    <div class="flex justify-between border-t border-gray-600 pt-2">
                                        <span class="text-gray-300 font-semibold">Total Despesas:</span>
                                        <span class="text-white font-bold">R$ ${(report.totalDespesas || 0).toFixed(2).replace('.', ',')}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h5 class="text-lg font-semibold text-white mb-3">Receita e Lucro</h5>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-300">Receita/Frete:</span>
                                        <span class="text-white">R$ ${(report.receita || 0).toFixed(2).replace('.', ',')}</span>
                                    </div>
                                    <div class="flex justify-between border-t border-gray-600 pt-2">
                                        <span class="text-gray-300 font-semibold">Lucro L√≠quido:</span>
                                        <span class="font-bold text-lg ${(report.lucroLiquido || 0) >= 0 ? 'text-green-400' : 'text-red-400'}">
                                            R$ ${(report.lucroLiquido || 0).toFixed(2).replace('.', ',')}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-800/30 p-6 rounded-xl border border-gray-600/30">
                            <h5 class="text-lg font-semibold text-white mb-4">Gr√°fico de Pizza - Gastos por Categoria</h5>
                            <div id="pieChart" class="h-64 flex items-center justify-center">
                                <canvas id="pieChartCanvas" width="200" height="200"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800/30 p-6 rounded-xl border border-gray-600/30">
                            <h5 class="text-lg font-semibold text-white mb-4">Gr√°fico de Barra - Lucro vs Despesa</h5>
                            <div id="barChart" class="h-64 flex items-center justify-center">
                                <canvas id="barChartCanvas" width="300" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot√µes de A√ß√£o -->
                    <div class="flex justify-center space-x-4 mt-6">
                        <button onclick="closeReportSummaryModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300">
                            Fechar
                        </button>
                        <button onclick="deleteReport(${report.id}); closeReportSummaryModal();" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300">
                            Excluir Relat√≥rio
                        </button>
                    </div>
                </div>
            `;

            // Gerar gr√°ficos
            generatePieChart(report);
            generateBarChart(report);
            
            document.getElementById('reportSummaryModal').classList.remove('hidden');
        }

        function closeReportSummaryModal() {
            document.getElementById('reportSummaryModal').classList.add('hidden');
        }

        // Vari√°vel para armazenar o ID do relat√≥rio a ser exclu√≠do
        let reportToDelete = null;

        // Excluir relat√≥rio
        function deleteReport(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;

            reportToDelete = reportId;
            
            // Configurar mensagem de confirma√ß√£o
            const confirmMessage = `Relat√≥rio de ${formatDate(report.date)}\n\n` +
                                 `Motorista: ${report.nomeMotorista || 'N√£o informado'}\n` +
                                 `Caminh√£o: ${report.nomeCaminhao || 'N√£o informado'}\n` +
                                 `Despesas: R$ ${(report.totalDespesas || 0).toFixed(2).replace('.', ',')}\n` +
                                 `Receita: R$ ${(report.receita || 0).toFixed(2).replace('.', ',')}\n` +
                                 `Lucro: R$ ${(report.lucroLiquido || 0).toFixed(2).replace('.', ',')}\n\n` +
                                 `Esta a√ß√£o n√£o pode ser desfeita!`;

            document.getElementById('confirmDeleteMessage').textContent = confirmMessage;
            document.getElementById('confirmDeleteModal').classList.remove('hidden');
        }

        // Confirmar exclus√£o
        function confirmDelete() {
            if (reportToDelete) {
                // Remover relat√≥rio da lista
                reports = reports.filter(r => r.id !== reportToDelete);
                
                // Salvar no localStorage
                localStorage.setItem('truckReports', JSON.stringify(reports));
                
                // Atualizar interface
                updateWeekSummary();
                
                // Fechar modais
                closeConfirmDeleteModal();
                closeReportSummaryModal();
                closePreviousReportsModal();
                
                showNotification('Relat√≥rio exclu√≠do com sucesso!', 'success');
                
                reportToDelete = null;
            }
        }

        // Fechar modal de confirma√ß√£o
        function closeConfirmDeleteModal() {
            document.getElementById('confirmDeleteModal').classList.add('hidden');
            reportToDelete = null;
        }

        // Configurar listener para o seletor de per√≠odo
        function setupPeriodSelectListener() {
            const periodSelect = document.getElementById('periodSelect');
            const customDateContainer = document.getElementById('customDateContainer');
            
            periodSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customDateContainer.classList.remove('hidden');
                    // Definir data atual como padr√£o
                    document.getElementById('customDate').value = new Date().toISOString().split('T')[0];
                } else {
                    customDateContainer.classList.add('hidden');
                }
            });
        }

        // Limpar filtros
        function clearFilters() {
            document.getElementById('periodSelect').value = 'day';
            document.getElementById('customDateContainer').classList.add('hidden');
            document.getElementById('periodReportContent').innerHTML = '';
        }

        // Gerar relat√≥rio por per√≠odo
        function generatePeriodReport() {
            console.log('Gerando relat√≥rio por per√≠odo...');
            console.log('Total de relat√≥rios dispon√≠veis:', reports.length);
            
            const period = document.getElementById('periodSelect').value;
            const content = document.getElementById('periodReportContent');
            
            let filteredReports = [];
            const now = new Date();
            
            switch(period) {
                case 'day':
                    filteredReports = reports.filter(r => {
                        const reportDate = new Date(r.date);
                        return reportDate.toDateString() === now.toDateString();
                    });
                    break;
                case 'week':
                    const weekStart = new Date(now.setDate(now.getDate() - now.getDay()));
                    filteredReports = reports.filter(r => {
                        const reportDate = new Date(r.date);
                        return reportDate >= weekStart;
                    });
                    break;
                case 'month':
                    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                    filteredReports = reports.filter(r => {
                        const reportDate = new Date(r.date);
                        return reportDate >= monthStart;
                    });
                    break;
                case 'custom':
                    const customDate = document.getElementById('customDate').value;
                    if (!customDate) {
                        showNotification('Por favor, selecione uma data!', 'error');
                        return;
                    }
                    filteredReports = reports.filter(r => {
                        return r.date === customDate;
                    });
                    break;
            }
            
            console.log('Relat√≥rios filtrados:', filteredReports.length);
            console.log('Relat√≥rios encontrados:', filteredReports);

            if (filteredReports.length === 0) {
                let message = 'Nenhum relat√≥rio encontrado para o per√≠odo selecionado';
                
                if (period === 'custom') {
                    const customDate = document.getElementById('customDate').value;
                    const formattedDate = customDate ? formatDate(customDate) : 'data selecionada';
                    message = `Nenhum relat√≥rio encontrado para a data ${formattedDate}`;
                } else if (period === 'day') {
                    message = 'Nenhum relat√≥rio encontrado para hoje';
                } else if (period === 'week') {
                    message = 'Nenhum relat√≥rio encontrado para esta semana';
                } else if (period === 'month') {
                    message = 'Nenhum relat√≥rio encontrado para este m√™s';
                }
                
                content.innerHTML = `
                    <div class="text-center text-gray-400 py-12">
                        <div class="text-6xl mb-4">üìä</div>
                        <p class="text-lg">${message}</p>
                        <p class="text-sm mt-2">Tente selecionar outro per√≠odo ou data</p>
                    </div>
                `;
                return;
            }

            let totalDespesas = 0;
            let totalReceita = 0;
            let totalLucro = 0;

            filteredReports.forEach(report => {
                totalDespesas += report.totalDespesas;
                totalReceita += report.receita;
                totalLucro += report.lucroLiquido;
            });

            // Gerar t√≠tulo do per√≠odo
            let periodTitle = '';
            if (period === 'custom') {
                const customDate = document.getElementById('customDate').value;
                periodTitle = `Relat√≥rios de ${formatDate(customDate)}`;
            } else if (period === 'day') {
                periodTitle = 'Relat√≥rios de Hoje';
            } else if (period === 'week') {
                periodTitle = 'Relat√≥rios desta Semana';
            } else if (period === 'month') {
                periodTitle = 'Relat√≥rios deste M√™s';
            }

            content.innerHTML = `
                <div class="space-y-6">
                    <div class="text-center mb-6">
                        <h4 class="text-2xl font-bold text-white">${periodTitle}</h4>
                        <p class="text-gray-300">${filteredReports.length} relat√≥rio(s) encontrado(s)</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-600/30 text-center">
                            <h4 class="text-white font-semibold">Total Despesas</h4>
                            <p class="text-2xl font-bold text-red-400">R$ ${totalDespesas.toFixed(2).replace('.', ',')}</p>
                        </div>
                        <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-600/30 text-center">
                            <h4 class="text-white font-semibold">Total Receita</h4>
                            <p class="text-2xl font-bold text-green-400">R$ ${totalReceita.toFixed(2).replace('.', ',')}</p>
                        </div>
                        <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-600/30 text-center">
                            <h4 class="text-white font-semibold">Lucro L√≠quido</h4>
                            <p class="text-2xl font-bold ${totalLucro >= 0 ? 'text-green-400' : 'text-red-400'}">R$ ${totalLucro.toFixed(2).replace('.', ',')}</p>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-white">Relat√≥rios do Per√≠odo (${filteredReports.length} encontrados)</h4>
                        ${filteredReports.map(report => `
                            <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-600/30">
                                <div class="flex justify-between items-center">
                                    <div class="flex-1">
                                        <h5 class="text-white font-semibold">${formatDate(report.date)}</h5>
                                        <p class="text-gray-300 text-sm">
                                            ${report.nomeMotorista ? `Motorista: ${report.nomeMotorista} | ` : ''}
                                            ${report.nomeCaminhao ? `Caminh√£o: ${report.nomeCaminhao}` : ''}
                                        </p>
                                        <p class="text-gray-300 text-sm">
                                            ${report.localPartida ? `Partida: ${report.localPartida} | ` : ''}
                                            ${report.localChegada ? `Chegada: ${report.localChegada}` : ''}
                                        </p>
                                        <p class="text-gray-300 text-sm mt-1">
                                            Despesas: R$ ${(report.totalDespesas || 0).toFixed(2).replace('.', ',')} | 
                                            Receita: R$ ${(report.receita || 0).toFixed(2).replace('.', ',')} | 
                                            Lucro: R$ ${(report.lucroLiquido || 0).toFixed(2).replace('.', ',')}
                                        </p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="viewReportSummary(${report.id})" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                            Ver Detalhes
                                        </button>
                                        <button onclick="deleteReport(${report.id})" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                            Excluir
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="exportToPDF()" class="flex-1 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                            Exportar PDF
                        </button>
                        <button onclick="exportToExcel()" class="flex-1 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                            Exportar Excel
                        </button>
                    </div>
                </div>
            `;
        }

        // Fun√ß√µes de configura√ß√µes
        function saveSettings() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword && newPassword !== confirmPassword) {
                showNotification('As senhas n√£o coincidem!', 'error');
                return;
            }
            
            if (newPassword) {
                showNotification('Senha alterada com sucesso!', 'success');
            }
            
            showNotification('Configura√ß√µes salvas!', 'success');
            closeSettingsModal();
        }

        function exportData() {
            const dataStr = JSON.stringify(reports, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `truckplan-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showNotification('Dados exportados com sucesso!', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            reports = importedData;
                            localStorage.setItem('truckReports', JSON.stringify(reports));
                            updateWeekSummary();
                            showNotification('Dados importados com sucesso!', 'success');
                        } catch (error) {
                            showNotification('Erro ao importar dados!', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function exportToPDF() {
            showNotification('Funcionalidade de PDF em desenvolvimento!', 'info');
        }

        function exportToExcel() {
            showNotification('Funcionalidade de Excel em desenvolvimento!', 'info');
        }

        // Fun√ß√µes auxiliares
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function getCurrentWeek() {
            const now = new Date();
            const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
            return startOfWeek;
        }

        function isSameWeek(date1, date2) {
            const week1 = getWeekNumber(date1);
            const week2 = getWeekNumber(date2);
            return week1 === week2 && date1.getFullYear() === date2.getFullYear();
        }

        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 animate-slide-up ${
                type === 'error' ? 'bg-red-100 text-red-700 border border-red-200' : 
                type === 'success' ? 'bg-green-100 text-green-700 border border-green-200' :
                'bg-blue-100 text-blue-700 border border-blue-200'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <span class="text-xl mr-2">${type === 'error' ? '‚ö†Ô∏è' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'}</span>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Gerar gr√°fico de pizza
        function generatePieChart(report) {
            const canvas = document.getElementById('pieChartCanvas');
            const ctx = canvas.getContext('2d');
            
            const data = [
                { label: 'Combust√≠vel', value: report.combustivel, color: '#3B82F6' },
                { label: 'Comida', value: report.comida, color: '#10B981' },
                { label: 'Aluguel', value: report.aluguel, color: '#F59E0B' },
                { label: 'Ped√°gios', value: report.pedagios, color: '#EF4444' },
                { label: 'Manuten√ß√£o', value: report.manutencao || 0, color: '#8B5CF6' },
                { label: 'Pneus', value: report.pneus || 0, color: '#F97316' },
                { label: 'Seguro', value: report.seguro || 0, color: '#06B6D4' },
                { label: 'IPVA', value: report.ipva || 0, color: '#84CC16' },
                { label: 'Outras', value: report.outrasDespesas, color: '#EC4899' }
            ].filter(item => item.value > 0);

            if (data.length === 0) {
                ctx.fillStyle = '#6B7280';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Sem dados', 100, 100);
                return;
            }

            const total = data.reduce((sum, item) => sum + item.value, 0);
            let currentAngle = 0;

            data.forEach(item => {
                const sliceAngle = (item.value / total) * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.moveTo(100, 100);
                ctx.arc(100, 100, 80, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = item.color;
                ctx.fill();
                
                currentAngle += sliceAngle;
            });
        }

        // Gerar gr√°fico de barra
        function generateBarChart(report) {
            const canvas = document.getElementById('barChartCanvas');
            const ctx = canvas.getContext('2d');
            
            const maxValue = Math.max(report.totalDespesas, report.receita);
            const barWidth = 100;
            const barHeight1 = (report.totalDespesas / maxValue) * 150;
            const barHeight2 = (report.receita / maxValue) * 150;
            
            // Despesas (vermelho)
            ctx.fillStyle = '#EF4444';
            ctx.fillRect(50, 180 - barHeight1, barWidth, barHeight1);
            ctx.fillStyle = '#FFFFFF';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Despesas', 100, 200);
            
            // Receita (verde)
            ctx.fillStyle = '#10B981';
            ctx.fillRect(200, 180 - barHeight2, barWidth, barHeight2);
            ctx.fillStyle = '#FFFFFF';
            ctx.fillText('Receita', 250, 200);
        }

        // Formata√ß√£o da placa do caminh√£o
        function formatPlaca(input) {
            let value = input.value.replace(/\D/g, '').toUpperCase();
            
            if (value.length <= 3) {
                input.value = value;
            } else if (value.length <= 7) {
                input.value = value.substring(0, 3) + '-' + value.substring(3);
            } else {
                input.value = value.substring(0, 3) + '-' + value.substring(3, 7);
            }
        }

        // Valida√ß√£o do formul√°rio
        function validateReportForm() {
            const dataViagem = document.getElementById('dataViagem').value;
            const localPartida = document.getElementById('localPartida').value.trim();
            const localChegada = document.getElementById('localChegada').value.trim();
            const quantidadeDiarias = parseInt(document.getElementById('quantidadeDiarias').value) || 0;
            const litrosGasolina = parseFloat(document.getElementById('litrosGasolina').value) || 0;
            const valorGasolina = parseFloat(document.getElementById('valorGasolina').value) || 0;
            const nomeMotorista = document.getElementById('nomeMotorista').value.trim();
            const nomeCaminhao = document.getElementById('nomeCaminhao').value.trim();
            
            console.log('Validando formul√°rio:', {
                dataViagem, localPartida, localChegada, quantidadeDiarias, 
                litrosGasolina, valorGasolina, nomeMotorista, nomeCaminhao
            });
            
            if (!dataViagem) {
                showNotification('Por favor, informe a data da viagem!', 'error');
                document.getElementById('dataViagem').focus();
                return false;
            }
            
            if (!localPartida) {
                showNotification('Por favor, informe o local de partida!', 'error');
                document.getElementById('localPartida').focus();
                return false;
            }
            
            if (!localChegada) {
                showNotification('Por favor, informe o local de chegada!', 'error');
                document.getElementById('localChegada').focus();
                return false;
            }
            
            if (quantidadeDiarias < 1) {
                showNotification('Por favor, informe a quantidade de di√°rias (m√≠nimo 1)!', 'error');
                document.getElementById('quantidadeDiarias').focus();
                return false;
            }
            
            if (litrosGasolina < 0) {
                showNotification('Por favor, informe a quantidade de litros de gasolina!', 'error');
                document.getElementById('litrosGasolina').focus();
                return false;
            }
            
            if (valorGasolina < 0) {
                showNotification('Por favor, informe o valor gasto com gasolina!', 'error');
                document.getElementById('valorGasolina').focus();
                return false;
            }
            
            if (!nomeMotorista) {
                showNotification('Por favor, informe o nome do motorista!', 'error');
                document.getElementById('nomeMotorista').focus();
                return false;
            }
            
            if (!nomeCaminhao) {
                showNotification('Por favor, informe o nome do caminh√£o!', 'error');
                document.getElementById('nomeCaminhao').focus();
                return false;
            }
            
            console.log('Formul√°rio v√°lido!');
            return true;
        }

        // Efeito de hover nos bot√µes
        const buttons = document.querySelectorAll('button');
        buttons.forEach(button => {
            button.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-4px)';
            });
            
            button.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // ========== FUN√á√ïES PARA CUSTOS GERAIS ==========
        
        // Array para armazenar custos gerais do relat√≥rio atual
        let custosGeraisRelatorio = [];

        // Buscar custos por placa
        function buscarCustosPorPlaca() {
            const placa = document.getElementById('buscarPlaca').value.trim().toUpperCase();
            if (placa.length < 3) {
                document.getElementById('custosEncontrados').innerHTML = '';
                return;
            }

            // Simular busca (em produ√ß√£o, isso seria uma chamada AJAX)
            const custosEncontrados = buscarCustosNoBanco(placa);
            exibirCustosEncontrados(custosEncontrados);
        }

        // Filtrar custos por tipo
        function filtrarCustosPorTipo() {
            const tipo = document.getElementById('filtrarTipo').value;
            const placa = document.getElementById('buscarPlaca').value.trim().toUpperCase();
            
            let custosEncontrados = [];
            if (placa.length >= 3) {
                custosEncontrados = buscarCustosNoBanco(placa, tipo);
            } else if (tipo) {
                custosEncontrados = buscarCustosPorTipoNoBanco(tipo);
            }
            
            exibirCustosEncontrados(custosEncontrados);
        }

        // Buscar custos no banco de dados (sem dados simulados)
        function buscarCustosNoBanco(placa, tipo = null) {
            // Retornar array vazio - sem dados simulados
            return [];
        }

        function buscarCustosPorTipoNoBanco(tipo) {
            // Buscar por tipo (sem dados simulados)
            return [];
        }

        // Exibir custos encontrados
        function exibirCustosEncontrados(custos) {
            const container = document.getElementById('custosEncontrados');
            
            if (custos.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm">Nenhum custo encontrado</p>';
                return;
            }

            const html = custos.map(custo => `
                <div class="bg-gray-700/50 p-3 rounded-lg border border-gray-600/30 cursor-pointer hover:bg-gray-700/70 transition-colors" 
                     onclick="adicionarCustoExistente(${custo.id})">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-xs bg-blue-600 text-white px-2 py-1 rounded">${getTipoDisplay(custo.tipo)}</span>
                                <span class="text-xs text-gray-400">${formatDate(custo.data)}</span>
                            </div>
                            <p class="text-sm text-white font-medium">${custo.oficina}</p>
                            <p class="text-xs text-gray-300">${custo.descricao}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-bold text-white">R$ ${custo.valor.toFixed(2).replace('.', ',')}</p>
                            <p class="text-xs ${custo.statusPagamento === 'pago' ? 'text-green-400' : 'text-red-400'}">
                                ${getStatusDisplay(custo.statusPagamento)}
                            </p>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        // Adicionar custo existente √† lista
        function adicionarCustoExistente(custoId) {
            // Em produ√ß√£o, buscar detalhes completos do custo
            const custo = buscarCustosNoBanco('').find(c => c.id === custoId);
            if (custo) {
                custosGeraisRelatorio.push(custo);
                atualizarListaCustosGerais();
                updateReportPreview(); // Atualizar preview ap√≥s adicionar custo existente
                showNotification('Custo adicionado ao relat√≥rio!', 'success');
            }
        }

        // Adicionar novo custo geral
        function adicionarCustoGeral() {
            const tipoGasto = document.getElementById('tipoGasto').value;
            const dataCusto = document.getElementById('dataCusto').value;
            const placaCusto = document.getElementById('placaCusto').value;
            const oficinaFornecedor = document.getElementById('oficinaFornecedor').value;
            const descricaoCusto = document.getElementById('descricaoCusto').value;
            const valorCusto = document.getElementById('valorCusto').value;
            const formaPagamento = document.getElementById('formaPagamento').value;
            const statusPagamento = document.getElementById('statusPagamento').value;
            const dataVencimento = document.getElementById('dataVencimento').value;
            const comprovante = document.getElementById('comprovante').files[0];

            // Valida√ß√£o
            if (!tipoGasto || !dataCusto || !placaCusto || !oficinaFornecedor || !descricaoCusto || !valorCusto || !formaPagamento || !statusPagamento) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }

            const novoCusto = {
                id: Date.now(), // ID tempor√°rio
                tipo: tipoGasto,
                data: dataCusto,
                placa: placaCusto.toUpperCase(),
                oficina: oficinaFornecedor,
                descricao: descricaoCusto,
                valor: parseFloat(valorCusto),
                formaPagamento: formaPagamento,
                statusPagamento: statusPagamento,
                dataVencimento: dataVencimento || null,
                comprovante: comprovante ? comprovante.name : null,
                isNew: true // Marcar como novo custo
            };

            custosGeraisRelatorio.push(novoCusto);
            atualizarListaCustosGerais();
            limparFormularioCusto();
            updateReportPreview(); // Atualizar preview ap√≥s adicionar custo
            showNotification('Custo adicionado com sucesso!', 'success');
        }

        // Atualizar lista de custos gerais
        function atualizarListaCustosGerais() {
            const container = document.getElementById('listaCustosGerais');
            
            if (custosGeraisRelatorio.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">Nenhum custo adicionado</p>';
                return;
            }

            const totalCustos = custosGeraisRelatorio.reduce((sum, custo) => sum + custo.valor, 0);

            const html = `
                <div class="bg-gray-800/30 p-4 rounded-xl border border-gray-600/30">
                    <div class="flex justify-between items-center mb-3">
                        <h6 class="text-md font-semibold text-white">Custos Adicionados (${custosGeraisRelatorio.length})</h6>
                        <span class="text-lg font-bold text-red-400">Total: R$ ${totalCustos.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div class="space-y-2 max-h-60 overflow-y-auto">
                        ${custosGeraisRelatorio.map((custo, index) => `
                            <div class="bg-gray-700/50 p-3 rounded-lg border border-gray-600/30">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <span class="text-xs bg-blue-600 text-white px-2 py-1 rounded">${getTipoDisplay(custo.tipo)}</span>
                                            <span class="text-xs text-gray-400">${formatDate(custo.data)}</span>
                                            ${custo.isNew ? '<span class="text-xs bg-green-600 text-white px-2 py-1 rounded">NOVO</span>' : ''}
                                        </div>
                                        <p class="text-sm text-white font-medium">${custo.oficina}</p>
                                        <p class="text-xs text-gray-300">${custo.descricao}</p>
                                        <p class="text-xs text-gray-400">Placa: ${custo.placa}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-bold text-white">R$ ${custo.valor.toFixed(2).replace('.', ',')}</p>
                                        <p class="text-xs ${custo.statusPagamento === 'pago' ? 'text-green-400' : 'text-red-400'}">
                                            ${getStatusDisplay(custo.statusPagamento)}
                                        </p>
                                        <button onclick="removerCustoGeral(${index})" class="text-red-400 hover:text-red-300 text-xs mt-1">
                                            Remover
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        // Remover custo da lista
        function removerCustoGeral(index) {
            custosGeraisRelatorio.splice(index, 1);
            atualizarListaCustosGerais();
            updateReportPreview(); // Atualizar preview ap√≥s remover custo
            showNotification('Custo removido!', 'info');
        }

        // Limpar formul√°rio de custo
        function limparFormularioCusto() {
            document.getElementById('tipoGasto').value = '';
            document.getElementById('dataCusto').value = '';
            document.getElementById('placaCusto').value = '';
            document.getElementById('oficinaFornecedor').value = '';
            document.getElementById('descricaoCusto').value = '';
            document.getElementById('valorCusto').value = '';
            document.getElementById('formaPagamento').value = '';
            document.getElementById('statusPagamento').value = '';
            document.getElementById('dataVencimento').value = '';
            document.getElementById('comprovante').value = '';
        }

        // Fun√ß√µes auxiliares
        function getTipoDisplay(tipo) {
            const tipos = {
                'manutencao': 'Manuten√ß√£o',
                'ipva': 'IPVA',
                'seguro': 'Seguro',
                'batida': 'Batida',
                'pecas': 'Pe√ßas',
                'acessorios': 'Acess√≥rios',
                'combustivel': 'Combust√≠vel',
                'documentacao': 'Documenta√ß√£o',
                'multas': 'Multas',
                'estacionamento': 'Estacionamento',
                'pedagio': 'Ped√°gio',
                'outros': 'Outros'
            };
            return tipos[tipo] || tipo;
        }

        function getStatusDisplay(status) {
            const statusMap = {
                'pago': 'Pago',
                'nao_pago': 'N√£o Pago',
                'parcial': 'Parcial'
            };
            return statusMap[status] || status;
        }

    </script>
</body>
</html>
