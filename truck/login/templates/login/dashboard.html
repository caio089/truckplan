{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruckPlan - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{% static 'login/css/styles.css' %}">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1',
                            400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155',
                            800: '#1e293b', 900: '#0f172a'
                        },
                        secondary: {
                            50: '#f9fafb', 100: '#f3f4f6', 200: '#e5e7eb', 300: '#d1d5db',
                            400: '#9ca3af', 500: '#6b7280', 600: '#4b5563', 700: '#374151',
                            800: '#1f2937', 900: '#111827'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'bounce-gentle': 'bounceGentle 2s infinite',
                        'pulse-slow': 'pulse 3s infinite'
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(30px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        bounceGentle: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #4b5563 100%);
        }
        .glass-effect {
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .mobile-p-2 { padding: 0.5rem; }
            .mobile-p-4 { padding: 1rem; }
            .mobile-p-6 { padding: 1.5rem; }
            .mobile-mb-4 { margin-bottom: 1rem; }
            .mobile-mb-6 { margin-bottom: 1.5rem; }
            .mobile-mb-8 { margin-bottom: 2rem; }
            .mobile-text-sm { font-size: 0.875rem; }
            .mobile-text-base { font-size: 1rem; }
            .mobile-text-lg { font-size: 1.125rem; }
            .mobile-text-xl { font-size: 1.25rem; }
            .mobile-text-2xl { font-size: 1.5rem; }
            .mobile-text-3xl { font-size: 1.875rem; }
            .mobile-text-4xl { font-size: 2.25rem; }
            .mobile-grid-1 { grid-template-columns: 1fr; }
            .mobile-grid-2 { grid-template-columns: repeat(2, 1fr); }
            .mobile-flex-col { flex-direction: column; }
            .mobile-items-center { align-items: center; }
            .mobile-justify-center { justify-content: center; }
            .mobile-text-center { text-align: center; }
            .mobile-space-y-2 > * + * { margin-top: 0.5rem; }
            .mobile-space-y-4 > * + * { margin-top: 1rem; }
            .mobile-gap-2 { gap: 0.5rem; }
            .mobile-gap-4 { gap: 1rem; }
            .mobile-gap-6 { gap: 1.5rem; }
            .mobile-rounded-lg { border-radius: 0.5rem; }
            .mobile-rounded-xl { border-radius: 0.75rem; }
            .mobile-rounded-2xl { border-radius: 1rem; }
            .mobile-hidden { display: none; }
            .mobile-block { display: block; }
            .mobile-w-full { width: 100%; }
            .mobile-touch-target { min-height: 44px; min-width: 44px; }
            .mobile-button { padding: 0.75rem 1rem; font-size: 0.875rem; }
            .mobile-input { font-size: 16px; padding: 0.75rem; }
            .mobile-overflow-x-auto { overflow-x: auto; }
            .mobile-table { min-width: 100%; }
            .mobile-table th, .mobile-table td { padding: 0.5rem; font-size: 0.875rem; }
        }
        
        /* Tablet optimizations */
        @media (min-width: 641px) and (max-width: 1024px) {
            .tablet-grid-2 { grid-template-columns: repeat(2, 1fr); }
            .tablet-grid-3 { grid-template-columns: repeat(3, 1fr); }
            .tablet-p-4 { padding: 1rem; }
            .tablet-p-6 { padding: 1.5rem; }
            .tablet-text-lg { font-size: 1.125rem; }
            .tablet-text-xl { font-size: 1.25rem; }
        }
        
        /* Very small screens */
        @media (max-width: 375px) {
            .xs-mobile-p-1 { padding: 0.25rem; }
            .xs-mobile-p-2 { padding: 0.5rem; }
            .xs-mobile-text-xs { font-size: 0.75rem; }
            .xs-mobile-text-sm { font-size: 0.875rem; }
            .xs-mobile-text-base { font-size: 1rem; }
            .xs-mobile-gap-2 { gap: 0.5rem; }
            .xs-mobile-gap-4 { gap: 1rem; }
        }
        
        /* Landscape mobile */
        @media (max-width: 896px) and (orientation: landscape) {
            .landscape-mobile-p-2 { padding: 0.5rem; }
            .landscape-mobile-mb-2 { margin-bottom: 0.5rem; }
            .landscape-mobile-text-sm { font-size: 0.875rem; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- CSRF Token -->
    {% csrf_token %}
    
    <!-- Background Animation -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-white/5 rounded-full animate-pulse-slow"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-gray-400/10 rounded-full animate-bounce-gentle"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-gray-300/5 rounded-full animate-pulse-slow"></div>
    </div>

    <!-- Navigation -->
    <nav class="relative z-10 p-2 sm:p-4 lg:p-6">
        <div class="max-w-7xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-2 sm:gap-4">
            <div class="flex items-center space-x-2 sm:space-x-3">
                <span class="text-2xl sm:text-3xl">üöõ</span>
                <h1 class="text-xl sm:text-2xl font-bold text-white">TruckPlan</h1>
            </div>
            <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4">
                <span class="text-gray-300 text-sm sm:text-base">Bem-vindo, {{ user.username }}!</span>
                <a href="{% url 'logout' %}" class="bg-gray-800/50 hover:bg-gray-700/50 text-white px-3 sm:px-4 py-2 rounded-lg transition-all duration-300 backdrop-blur-sm border border-gray-600 mobile-touch-target text-sm sm:text-base">
                    Sair
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="relative z-10 max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 pb-8 sm:pb-12">
        <!-- Welcome Section -->
        <div class="text-center mb-8 sm:mb-12 animate-slide-up">
            <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-2 sm:mb-4">Dashboard</h2>
            <p class="text-gray-300 text-sm sm:text-base lg:text-lg">Sistema de Controle de Despesas de Caminh√£o</p>
        </div>

        <!-- Resumo Financeiro -->
        <div class="glass-effect rounded-2xl p-4 sm:p-6 lg:p-8 animate-slide-up border border-gray-600/30 mb-6 sm:mb-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-4">
                <h3 class="text-xl sm:text-2xl font-bold text-white">Resumo Financeiro</h3>
                <div class="flex space-x-2 w-full sm:w-auto">
                    <button id="btnSemanal" onclick="alternarResumo('semanal')" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold transition-all duration-300 mobile-touch-target text-sm sm:text-base">
                        Semanal
                    </button>
                    <button id="btnMensal" onclick="alternarResumo('mensal')" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-gray-600 text-white rounded-lg font-semibold transition-all duration-300 mobile-touch-target text-sm sm:text-base">
                        Mensal
                    </button>
                </div>
            </div>
            
            <div id="resumoSemanal" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                <div class="bg-gradient-to-r from-red-600 to-red-700 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100 text-xs sm:text-sm font-medium">Total de Gastos</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold" id="totalGastosSemanal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Esta semana</p>
                        </div>
                        <div class="text-2xl sm:text-3xl lg:text-4xl opacity-80">üí∞</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-green-600 to-green-700 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-xs sm:text-sm font-medium">Total de Receitas</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold" id="totalLucrosSemanal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Esta semana</p>
                        </div>
                        <div class="text-2xl sm:text-3xl lg:text-4xl opacity-80">üìà</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-xs sm:text-sm font-medium">Lucro L√≠quido</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold" id="lucroLiquidoSemanal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Esta semana</p>
                        </div>
                        <div class="text-2xl sm:text-3xl lg:text-4xl opacity-80">üíé</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-100 text-xs sm:text-sm font-medium">M√©dia Di√°ria</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold" id="mediaDiariaSemanal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Por dia</p>
                        </div>
                        <div class="text-2xl sm:text-3xl lg:text-4xl opacity-80">üìä</div>
                    </div>
                </div>
            </div>

            <div id="resumoMensal" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 hidden">
                <div class="bg-gradient-to-r from-red-600 to-red-700 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100 text-xs sm:text-sm font-medium">Total de Gastos</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold" id="totalGastosMensal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Este m√™s</p>
                        </div>
                        <div class="text-2xl sm:text-3xl lg:text-4xl opacity-80">üí∞</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-green-600 to-green-700 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-xs sm:text-sm font-medium">Total de Receitas</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold" id="totalLucrosMensal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Este m√™s</p>
                        </div>
                        <div class="text-2xl sm:text-3xl lg:text-4xl opacity-80">üìà</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-xs sm:text-sm font-medium">Lucro L√≠quido</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold" id="lucroLiquidoMensal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Este m√™s</p>
                        </div>
                        <div class="text-2xl sm:text-3xl lg:text-4xl opacity-80">üíé</div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-100 text-xs sm:text-sm font-medium">M√©dia Di√°ria</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold" id="mediaDiariaMensal">R$ 0,00</p>
                            <p class="text-xs opacity-80">Por dia</p>
                        </div>
                        <div class="text-2xl sm:text-3xl lg:text-4xl opacity-80">üìä</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Busca por Data -->
        <div class="glass-effect rounded-2xl p-4 sm:p-6 lg:p-8 animate-slide-up border border-gray-600/30 mb-6 sm:mb-8">
            <h3 class="text-xl sm:text-2xl font-bold text-white mb-4 sm:mb-6">üîç Buscar Relat√≥rios por Data</h3>
            
            <!-- Bot√µes de Navega√ß√£o para Relat√≥rios -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6">
                <button onclick="irParaRelatorioDiario()" class="bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-500 hover:to-orange-600 text-white px-3 sm:px-4 lg:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center cursor-pointer mobile-touch-target text-sm sm:text-base">
                    <span class="mr-2 text-sm sm:text-base">üìÖ</span>
                    <span class="hidden sm:inline">Relat√≥rio Di√°rio</span>
                    <span class="sm:hidden">Di√°rio</span>
                </button>
                <button onclick="irParaRelatorioSemanal()" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white px-3 sm:px-4 lg:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center cursor-pointer mobile-touch-target text-sm sm:text-base">
                    <span class="mr-2 text-sm sm:text-base">üìä</span>
                    <span class="hidden sm:inline">Relat√≥rio Semanal</span>
                    <span class="sm:hidden">Semanal</span>
                </button>
                <button onclick="irParaRelatorioMensal()" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white px-3 sm:px-4 lg:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center cursor-pointer mobile-touch-target text-sm sm:text-base">
                    <span class="mr-2 text-sm sm:text-base">üìà</span>
                    <span class="hidden sm:inline">Relat√≥rio Mensal</span>
                    <span class="sm:hidden">Mensal</span>
                </button>
                <button onclick="showPreviousReports()" class="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-500 hover:to-purple-600 text-white px-3 sm:px-4 lg:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center cursor-pointer mobile-touch-target text-sm sm:text-base">
                    <span class="mr-2 text-sm sm:text-base">üìã</span>
                    <span class="hidden sm:inline">Relat√≥rios Anteriores</span>
                    <span class="sm:hidden">Anteriores</span>
                </button>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                <div>
                    <label class="block text-gray-200 text-sm font-semibold mb-2">üìÖ Data Espec√≠fica</label>
                    <input type="date" id="dataEspecifica" class="w-full px-3 sm:px-4 py-2 sm:py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20 mobile-input" placeholder="Selecione a data">
                </div>
                <div class="flex items-end">
                    <button onclick="buscarRelatorioPorData()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-semibold transition-all duration-300 mobile-touch-target text-sm sm:text-base">
                        üîç Buscar Relat√≥rio
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="glass-effect rounded-2xl p-4 sm:p-6 lg:p-8 animate-slide-up border border-gray-600/30 mb-6 sm:mb-8">
            <h3 class="text-xl sm:text-2xl font-bold text-white mb-4 sm:mb-6">A√ß√µes R√°pidas</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                <button onclick="openReportModal()" class="bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white p-4 sm:p-6 rounded-xl font-semibold text-base sm:text-lg hover:-translate-y-1 hover:shadow-xl transition-all duration-300 border border-gray-600 mobile-touch-target">
                    <div class="flex flex-col items-center justify-center space-y-1 sm:space-y-2">
                        <span class="text-2xl sm:text-3xl">üìä</span>
                        <span class="text-xs sm:text-sm">Novo Relat√≥rio</span>
                    </div>
                </button>

                <button onclick="mostrarRelatoriosHoje()" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white p-4 sm:p-6 rounded-xl font-semibold text-base sm:text-lg hover:-translate-y-1 hover:shadow-xl transition-all duration-300 border border-green-500 mobile-touch-target">
                    <div class="flex flex-col items-center justify-center space-y-1 sm:space-y-2">
                        <span class="text-2xl sm:text-3xl">üìÖ</span>
                        <span class="text-xs sm:text-sm">Hoje</span>
                    </div>
                </button>

                <button onclick="mostrarRelatoriosSemana()" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white p-4 sm:p-6 rounded-xl font-semibold text-base sm:text-lg hover:-translate-y-1 hover:shadow-xl transition-all duration-300 border border-blue-500 mobile-touch-target">
                    <div class="flex flex-col items-center justify-center space-y-1 sm:space-y-2">
                        <span class="text-2xl sm:text-3xl">üìà</span>
                        <span class="text-xs sm:text-sm">Esta Semana</span>
                    </div>
                </button>

                <button onclick="mostrarRelatoriosMes()" class="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-500 hover:to-purple-600 text-white p-4 sm:p-6 rounded-xl font-semibold text-base sm:text-lg hover:-translate-y-1 hover:shadow-xl transition-all duration-300 border border-purple-500 mobile-touch-target">
                    <div class="flex flex-col items-center justify-center space-y-1 sm:space-y-2">
                        <span class="text-2xl sm:text-3xl">üìä</span>
                        <span class="text-xs sm:text-sm">Este M√™s</span>
                    </div>
                </button>

            </div>
        </div>

        <!-- Resultados da Busca -->
        <div id="resultadosBusca" class="hidden">
            <div class="glass-effect rounded-2xl p-8 animate-slide-up border border-gray-600/30 mb-8">
                <h3 class="text-2xl font-bold text-white mb-6">üìä Resultados da Busca</h3>
                <div id="resumoResultados" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Resumo ser√° preenchido aqui -->
                </div>
                <div id="tabelaResultados" class="overflow-x-auto">
                    <!-- Tabela ser√° preenchida aqui -->
                </div>
            </div>
        </div>

        <!-- Custos Fixos Mensais -->
        <div class="glass-effect rounded-2xl p-4 sm:p-6 lg:p-8 animate-slide-up border border-gray-600/30 mb-6 sm:mb-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-3">
                <h3 class="text-xl sm:text-2xl font-bold text-white">üí∞ Custos Fixos Mensais</h3>
                <button onclick="openCustosFixosModal()" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white px-3 sm:px-4 py-2 rounded-lg font-semibold transition-all duration-300 mobile-touch-target text-sm sm:text-base w-full sm:w-auto">
                    ‚ûï Adicionar Custo Fixo
                </button>
            </div>
            
            {% if custos_fixos_mensais %}
            <div class="mb-6">
                
                <!-- Custos Fixos Mensais -->
                {% if custos_fixos_mensais %}
                <div>
                    <h4 class="text-base sm:text-lg font-semibold text-blue-300 mb-3 sm:mb-4">üìÖ Custos Fixos Mensais (R$ {{ total_custos_fixos_mensais|floatformat:2 }})</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                        {% for custo in custos_fixos_mensais %}
                        <div class="bg-gradient-to-r from-blue-600/20 to-blue-700/20 rounded-xl p-3 sm:p-4 border border-blue-500/30">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1 min-w-0">
                                    <p class="text-blue-200 text-xs sm:text-sm font-medium">{{ custo.get_tipo_custo_display }}</p>
                                    <p class="text-sm sm:text-base lg:text-lg font-bold text-white truncate">{{ custo.descricao }}</p>
                                    <p class="text-xs sm:text-sm text-blue-300">R$ {{ custo.valor_mensal|floatformat:2 }}/m√™s</p>
                                    {% if custo.data_fim %}
                                    <p class="text-xs text-gray-400">At√© {{ custo.data_fim|date:"d/m/Y" }}</p>
                                    {% endif %}
                                </div>
                                <div class="flex items-center space-x-1 sm:space-x-2 ml-2">
                                    <div class="text-lg sm:text-xl lg:text-2xl opacity-80">
                                        {% if custo.tipo_custo == 'parcela_caminhao' %}üöõ
                                        {% elif custo.tipo_custo == 'seguro' %}üõ°Ô∏è
                                        {% elif custo.tipo_custo == 'ipva' %}üìã
                                        {% elif custo.tipo_custo == 'licenciamento' %}üìÑ
                                        {% elif custo.tipo_custo == 'manutencao_preventiva' %}üîß
                                        {% else %}üí∞{% endif %}
                                    </div>
                                    <div class="flex flex-col space-y-1">
                                        <a href="{% url 'editar_custo_fixo' custo.id %}" class="bg-yellow-600 hover:bg-yellow-700 text-white px-1 sm:px-2 py-1 rounded text-xs transition-colors text-center mobile-touch-target" title="Editar">
                                            ‚úèÔ∏è
                                        </a>
                                        <form method="post" action="{% url 'apagar_custo_fixo' custo.id %}" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja apagar este custo fixo? Esta a√ß√£o n√£o pode ser desfeita.');">
                                            {% csrf_token %}
                                            <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-1 sm:px-2 py-1 rounded text-xs transition-colors w-full mobile-touch-target" title="Apagar">
                                                üóëÔ∏è
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            {% if custo.observacoes %}
                            <p class="text-xs text-gray-400 mt-2 break-words">{{ custo.observacoes|truncatechars:50 }}</p>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <div class="mt-3 sm:mt-4 p-3 sm:p-4 bg-gradient-to-r from-gray-700/50 to-gray-800/50 rounded-xl">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2">
                        <span class="text-base sm:text-lg font-semibold text-white">Total de Custos Fixos</span>
                        <span class="text-xl sm:text-2xl font-bold text-blue-400">R$ {{ total_custos_fixos_mensais|floatformat:2 }}</span>
                    </div>
                    <p class="text-xs sm:text-sm text-gray-400 mt-1">Custos fixos mensais</p>
                </div>
            </div>
            {% else %}
            <div class="text-center text-gray-400 py-6 sm:py-8">
                <span class="text-3xl sm:text-4xl">üí≥</span>
                <p class="mt-2 text-sm sm:text-base">Nenhum custo fixo cadastrado</p>
                <p class="text-xs sm:text-sm">Adicione parcelas do caminh√£o, seguro, IPVA, etc.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Modais ser√£o adicionados aqui via JavaScript -->
    <div id="reportModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Gerar Novo Relat√≥rio</h3>
                <button onclick="closeReportModal()" class="text-gray-400 hover:text-white text-2xl">√ó</button>
            </div>
            <div id="reportFormContainer">
                <form id="reportForm" class="space-y-6">
                    <!-- Campo oculto para ID do relat√≥rio sendo editado -->
                    <input type="hidden" id="editReportId" name="editReportId" value="">
                    
                    <!-- Cadastro de Viagem -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-white">Cadastro de Viagem</h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Data da Viagem *</label>
                                <input type="date" id="dataViagem" name="dataViagem" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Local de Partida *</label>
                                <input type="text" id="localPartida" name="localPartida" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="Ex: S√£o Paulo - SP" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Local de Chegada *</label>
                                <input type="text" id="localChegada" name="localChegada" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="Ex: Rio de Janeiro - RJ" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Quantidade de Di√°rias *</label>
                                <input type="number" id="quantidadeDiarias" name="quantidadeDiarias" min="1" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="1" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Nome do Motorista *</label>
                                <input type="text" id="nomeMotorista" name="nomeMotorista" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="Nome completo do motorista" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Nome do Caminh√£o *</label>
                                <input type="text" id="nomeCaminhao" name="nomeCaminhao" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="Ex: Volvo FH 540" required>
                            </div>
                        </div>
                    </div>

                    <!-- Despesas da Viagem -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-white">Despesas da Viagem</h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Litros de Gasolina Gastos *</label>
                                <input type="number" id="litrosGasolina" name="litrosGasolina" step="0.01" min="0" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="0,00" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Valor Gasto com Gasolina (R$) *</label>
                                <input type="number" id="valorGasolina" name="valorGasolina" step="0.01" min="0" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="0,00" required>
                            </div>
                        </div>
                    </div>

                    <!-- Receita -->
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-4">Receita</h4>
                        <div>
                            <label class="block text-gray-200 text-sm font-semibold mb-2">Receita/Frete (R$)</label>
                            <input type="number" id="receita" name="receita" step="0.01" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="0,00">
                        </div>
                    </div>

                    <!-- Sal√°rio do Motorista -->
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-4">Sal√°rio do Motorista</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Sal√°rio Base (R$)</label>
                                <input type="number" id="salario_base" name="salario_base" step="0.01" min="0" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="0,00">
                            </div>
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">B√¥nus por Viagens (R$)</label>
                                <input type="number" id="bonus_viagens" name="bonus_viagens" step="0.01" min="0" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="0,00">
                            </div>
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Desconto por Faltas (R$)</label>
                                <input type="number" id="desconto_faltas" name="desconto_faltas" step="0.01" min="0" class="w-full px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-xl text-white focus:border-gray-400 focus:ring-4 focus:ring-gray-200/20" placeholder="0,00">
                            </div>
                        </div>
                    </div>

                    <!-- Custos Adicionais -->
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-4">üîß Custos Adicionais (Opcional)</h4>
                        <p class="text-gray-400 text-sm mb-4">Adicione custos extras como manuten√ß√£o, ped√°gios, multas, etc. Apenas os campos marcados com * s√£o obrigat√≥rios.</p>
                        
                        <!-- Formul√°rio para Adicionar Custo -->
                        <div class="bg-gray-800/30 rounded-xl p-4 border border-gray-600/30 mb-4">
                            <h5 class="text-md font-semibold text-white mb-3">‚ûï Adicionar Novo Custo</h5>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Tipo de Gasto *</label>
                                    <select id="tipoGasto" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                        <option value="">Selecione</option>
                                        <option value="manutencao">Manuten√ß√£o</option>
                                        <option value="combustivel">Combust√≠vel</option>
                                        <option value="pedagio">Ped√°gio</option>
                                        <option value="alimentacao">Alimenta√ß√£o</option>
                                        <option value="hospedagem">Hospedagem</option>
                                        <option value="outros">Outros</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Data do Custo</label>
                                    <input type="date" id="dataCusto" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Placa do Ve√≠culo</label>
                                    <input type="text" id="placaCusto" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="ABC-1234 (opcional)">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Oficina/Fornecedor</label>
                                    <input type="text" id="oficinaFornecedor" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="Nome da oficina ou fornecedor (opcional)">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Descri√ß√£o *</label>
                                    <input type="text" id="descricaoCusto" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="Descri√ß√£o do gasto">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Valor (R$) *</label>
                                    <input type="number" id="valorCusto" step="0.01" min="0" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="0,00">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Forma de Pagamento</label>
                                    <select id="formaPagamento" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" onchange="toggleParcelas()">
                                        <option value="">Selecione (opcional)</option>
                                        <option value="vista">√Ä Vista</option>
                                        <option value="credito">Cart√£o de Cr√©dito</option>
                                        <option value="debito">Cart√£o de D√©bito</option>
                                        <option value="pix">PIX</option>
                                        <option value="parcelado">Parcelado</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Status do Pagamento</label>
                                    <select id="statusPagamento" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                        <option value="">Selecione (opcional)</option>
                                        <option value="pago">Pago</option>
                                        <option value="pendente">Pendente</option>
                                        <option value="vencido">Vencido</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Data de Vencimento</label>
                                    <input type="date" id="dataVencimento" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Comprovante</label>
                                    <input type="file" id="comprovante" accept="image/*,.pdf" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                </div>
                            </div>
                            
                            <!-- Campos de Parcelas (ocultos por padr√£o) -->
                            <div id="camposParcelas" class="hidden mt-4 p-4 bg-gray-700/30 rounded-lg">
                                <h6 class="text-white font-semibold mb-3">üìÖ Configura√ß√£o de Parcelas</h6>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-gray-200 text-sm font-semibold mb-2">Quantidade de Parcelas</label>
                                        <input type="number" id="quantidadeParcelas" min="1" max="24" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="1">
                                    </div>
                                    <div>
                                        <label class="block text-gray-200 text-sm font-semibold mb-2">Valor da Parcela (R$)</label>
                                        <input type="number" id="valorParcela" step="0.01" min="0" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="0,00">
                                    </div>
                                    <div>
                                        <label class="block text-gray-200 text-sm font-semibold mb-2">Data da Primeira Parcela</label>
                                        <input type="date" id="dataPrimeiraParcela" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                    </div>
                                    <div>
                                        <label class="block text-gray-200 text-sm font-semibold mb-2">Dia de Vencimento</label>
                                        <input type="number" id="diaVencimento" min="1" max="31" value="15" class="w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="15">
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <button type="button" onclick="calcularParcelas()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
                                        üìä Calcular Parcelas
                                    </button>
                                </div>
                                
                                <!-- Preview das Parcelas -->
                                <div id="previewParcelas" class="hidden mt-4">
                                    <h6 class="text-white font-semibold mb-2">üìã Cronograma de Parcelas</h6>
                                    <div id="listaParcelas" class="space-y-2 max-h-40 overflow-y-auto">
                                        <!-- Parcelas ser√£o exibidas aqui -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <button type="button" id="btnAdicionarCusto" onclick="adicionarCustoGeral()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    ‚ûï Adicionar Custo
                                </button>
                            </div>
                        </div>
                        
                        <!-- Lista de Custos Adicionados -->
                        <div id="listaCustosGerais" class="bg-gray-800/30 rounded-xl p-4 border border-gray-600/30">
                            <h5 class="text-md font-semibold text-white mb-3">üìã Custos Adicionados</h5>
                            <div id="listaCustosGeraisContent">
                                <p class="text-gray-400 text-sm text-center py-4">Nenhum custo adicionado</p>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="flex space-x-4">
                        <button type="button" onclick="closeReportModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300">
                            Cancelar
                        </button>
                        <button type="submit" class="flex-1 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300 border border-gray-600">
                            Salvar Relat√≥rio
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Custos Fixos Mensais -->
    <div id="custosFixosModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">üí∞ Custos Fixos Mensais</h3>
                <button onclick="closeCustosFixosModal()" class="text-gray-400 hover:text-white text-2xl">√ó</button>
            </div>
            <div id="custosFixosFormContainer">
                <div class="space-y-6">
                    <!-- Formul√°rio para Adicionar Custo Fixo -->
                    <div class="bg-gray-800/30 rounded-xl p-6 border border-gray-600/30">
                        <h4 class="text-lg font-semibold text-white mb-4">‚ûï Adicionar Novo Custo Fixo</h4>
                        
                        <form id="custoFixoForm" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Descri√ß√£o *</label>
                                    <input type="text" id="descricaoCustoFixo" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="Ex: Parcela do Caminh√£o Volvo">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Tipo de Custo *</label>
                                    <select id="tipoCustoFixo" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                        <option value="">Selecione</option>
                                        <option value="parcela_caminhao">Parcela do Caminh√£o</option>
                                        <option value="seguro">Seguro</option>
                                        <option value="ipva">IPVA</option>
                                        <option value="licenciamento">Licenciamento</option>
                                        <option value="manutencao_preventiva">Manuten√ß√£o Preventiva</option>
                                        <option value="outros">Outros</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Valor Mensal (R$) *</label>
                                    <input type="number" id="valorMensalCustoFixo" step="0.01" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="0,00">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Data de In√≠cio *</label>
                                    <input type="date" id="dataInicioCustoFixo" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Data de Fim (opcional)</label>
                                    <input type="date" id="dataFimCustoFixo" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-200 text-sm font-semibold mb-2">Status</label>
                                    <select id="statusCustoFixo" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20">
                                        <option value="ativo">Ativo</option>
                                        <option value="inativo">Inativo</option>
                                        <option value="finalizado">Finalizado</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-gray-200 text-sm font-semibold mb-2">Observa√ß√µes</label>
                                <textarea id="observacoesCustoFixo" rows="3" class="w-full px-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:border-gray-400 focus:ring-2 focus:ring-gray-200/20" placeholder="Observa√ß√µes adicionais..."></textarea>
                            </div>
                            
                            <div class="flex justify-end space-x-4">
                                <button type="button" onclick="closeCustosFixosModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                                    Cancelar
                                </button>
                                <button type="button" onclick="salvarCustoFixo()" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white px-6 py-2 rounded-lg font-semibold transition-all duration-300">
                                    üíæ Salvar Custo Fixo
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Lista de Custos Fixos Existentes -->
                    <div class="bg-gray-800/30 rounded-xl p-6 border border-gray-600/30">
                        <h4 class="text-lg font-semibold text-white mb-4">üìã Custos Fixos Cadastrados</h4>
                        <div id="listaCustosFixos" class="space-y-3">
                            <!-- Custos fixos ser√£o carregados aqui via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{% static 'login/js/scripts.js' %}?v=20250122194500"></script>
    <script>
        // Limpar dados de teste
        localStorage.removeItem('truckReports');
        localStorage.removeItem('truckCosts');
        
        // Carregar dados do servidor quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            carregarRelatoriosDoServidor();
        });
        
        // Fun√ß√£o para ir para relat√≥rio di√°rio
        function irParaRelatorioDiario() {
            window.location.href = "{% url 'relatorio_diario' %}";
        }
        
    </script>
</body>
</html>
